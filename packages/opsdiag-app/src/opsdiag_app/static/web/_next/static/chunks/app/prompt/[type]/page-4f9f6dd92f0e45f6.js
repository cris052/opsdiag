(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1910],{21208:(e,l,a)=>{"use strict";a.d(l,{default:()=>U});var t=a(95155),s=a(91070),n=a(28867),r=a(7132),i=a(66766),o=a(12115);let c=(0,o.memo)(e=>{let{width:l,height:a,model:s}=e,n=(0,o.useMemo)(()=>(0,r.ZI)(s||"huggingface"),[s]);return s?(0,t.jsx)(i.default,{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:l||24,height:a||24,src:n,alt:"llm",priority:!0}):null});var d=a(47937),m=a(81702),p=a(88276),u=a(95069),h=a(78936),x=a(17295),_=a(24517),g=a(54099),f=a(1828),j=a(76174),v=a(55887),y=a(32570),b=a(97226),A=a(98696),N=a(6124),w=a(94481),S=a(32013),C=a(56939),E=a(29300),F=a.n(E),O=a(39092),V=a(55028),I=a(35695),k=a(91218);a(91214);var P=a(49509);let L=(0,V.default)(()=>a.e(6452).then(a.bind(a,96452)),{loadableGenerated:{webpack:()=>[96452]},ssr:!1}),T=new O.A,J=(0,V.default)(()=>Promise.all([a.e(562),a.e(240),a.e(5600),a.e(2826),a.e(7330),a.e(4935),a.e(4316),a.e(8779),a.e(3930),a.e(3485),a.e(5033),a.e(7985),a.e(797),a.e(2343),a.e(6467),a.e(7744),a.e(2275),a.e(5719),a.e(9211),a.e(8709),a.e(4496)]).then(a.bind(a,40102)),{loadableGenerated:{webpack:()=>[40102]},ssr:!1}),R=[{value:"Agent",label:"AGENT"},{value:"Scene",label:"SCENE"},{value:"Normal",label:"NORMAL"},{value:"Evaluate",label:"EVALUATE"}],M=e=>{let{value:l,onChange:a}=e,s=e=>{isNaN(e)||null==a||a(e)};return(0,t.jsxs)("div",{className:"flex items-center gap-8",children:[(0,t.jsx)(f.A,{className:"w-40",min:0,max:1,step:.1,onChange:s,value:l}),(0,t.jsx)(j.A,{className:"w-16",min:0,max:1,step:.1,value:l,onChange:s})]})},U=()=>{var e;let l=(0,I.useRouter)(),a=(0,I.useParams)(),r=(null==a?void 0:a.type)||"",{t:i}=(0,k.Bd)(),{modelList:f,model:j,mode:E}=(0,o.useContext)(s.UK),O="dark"===E?x.j:_.n,{message:V}=v.A.useApp(),[U,q]=(0,o.useState)(""),[W,z]=(0,o.useState)([]),[B,G]=(0,o.useState)({}),[H,D]=(0,o.useState)([]),[K,X]=(0,o.useState)(!1),[Y]=y.A.useForm(),[Z]=y.A.useForm(),[Q]=y.A.useForm(),[$,ee]=(0,o.useState)(),el=y.A.useWatch("prompt_type",Y),ea=(0,o.useMemo)(()=>f.map(e=>({value:e,label:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(c,{model:e}),(0,t.jsx)("span",{className:"ml-2",children:e})]})})),[f]),et=(0,o.useCallback)(e=>{q(e.text)},[]),{data:es,run:en,loading:er}=(0,g.A)(async e=>await (0,n.C5)(e),{manual:!0}),{run:ei}=(0,g.A)(async e=>await (0,n.b1)({prompt_type:el,target:null!=e?e:"",sub_target:""}),{manual:!0,onSuccess:e=>{if(e){let{data:l}=e.data;q(l.template),z(l.input_variables);try{let e=JSON.parse(l.response_format);G(e||{})}catch(e){G({})}}}}),{run:eo,loading:ec}=(0,g.A)(async e=>"add"===r?await (0,n.Vb)((0,n.Wz)(e)):await (0,n.Vb)((0,n.qj)(e)),{manual:!0,onSuccess:()=>{V.success("".concat("add"===r?i("Add"):i("update")).concat(i("success"))),l.replace("/prompt")}}),ed=async()=>{if(K)return;let e=Z.getFieldsValue();if(!Q.getFieldValue("user_input"))return void V.warning(i("Please_fill_in_the_user_input"));Y.validateFields().then(async l=>{let a={sub_chat_scene:"",model:Q.getFieldValue("model"),chat_scene:l.target,prompt_name:l.prompt_name,prompt_type:l.prompt_type,content:U,response_schema:JSON.stringify(B),input_variables:JSON.stringify(W),prompt_language:Q.getFieldValue("prompt_language"),prompt_desc:"",prompt_code:l.prompt_code,temperature:Q.getFieldValue("temperature"),debug_model:Q.getFieldValue("model"),input_values:{...e},user_input:Q.getFieldValue("user_input")},t=[{role:"view",context:""}],s=t.length-1;try{var n,r;X(!0),await (0,u.y)("".concat(null!=(n=P.env.NEXT_PUBLIC_API_BASE_URL)?n:"","/prompt/template/debug"),{method:"POST",headers:{"Content-Type":"application/json",[m.uz]:null!=(r=(0,d.F6)())?r:""},body:JSON.stringify(a),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===u.o)return},onclose(){X(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;if(l){try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?X(!1):(null==l?void 0:l.startsWith("[ERROR]"))?(X(!1),t[s].context=null==l?void 0:l.replace("[ERROR]","")):(t[s].context=l,D([...t]))}}})}catch(e){X(!1),t[s].context="Sorry, we meet some error, please try again later",D([...t])}})},{run:em,loading:ep}=(0,g.A)(async()=>await (0,n.f1)({llm_out:H[0].context,prompt_type:Y.getFieldValue("prompt_type"),chat_scene:Y.getFieldValue("target")}),{manual:!0,onSuccess:e=>{var l,a;(null==e||null==(l=e.data)?void 0:l.success)?ee({msg:"验证通过",status:"success"}):ee({msg:null==e||null==(a=e.data)?void 0:a.err_msg,status:"error"})}});(0,o.useEffect)(()=>{j&&Q.setFieldsValue({model:j})},[Q,j]),(0,o.useEffect)(()=>{el&&en(el)},[en,el]);let eu=(0,o.useMemo)(()=>{var e,l;return null==es||null==(l=es.data)||null==(e=l.data)?void 0:e.map(e=>({...e,value:e.name,label:e.name}))},[es]);return(0,o.useEffect)(()=>{if("edit"===r){var e;let l=JSON.parse(localStorage.getItem("edit_prompt_data")||"{}");z(JSON.parse(null!=(e=l.input_variables)?e:"[]")),q(null==l?void 0:l.content),Y.setFieldsValue({prompt_type:l.prompt_type,prompt_name:l.prompt_name,prompt_code:l.prompt_code,target:l.chat_scene}),Q.setFieldsValue({model:l.model,prompt_language:l.prompt_language})}},[Q,Y,r]),(0,t.jsxs)("div",{className:"flex flex-col w-full h-full justify-between dark:bg-gradient-dark }",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between px-6 py-2 h-14 border-b border-[#edeeef]",children:[(0,t.jsxs)(b.A,{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"text-base cursor-pointer hover:text-[#0c75fc]",onClick:()=>{localStorage.removeItem("edit_prompt_data"),l.replace("/prompt")}}),(0,t.jsxs)("span",{className:"font-medium text-sm",children:["add"===r?i("Add"):i("Edit")," Prompt"]})]}),(0,t.jsx)(b.A,{children:(0,t.jsx)(A.Ay,{type:"primary",onClick:()=>{Y.validateFields().then(async e=>{let l={sub_chat_scene:"",model:Q.getFieldValue("model"),chat_scene:e.target,prompt_name:e.prompt_name,prompt_type:e.prompt_type,content:U,response_schema:JSON.stringify(B),input_variables:JSON.stringify(W),prompt_language:Q.getFieldValue("prompt_language"),prompt_desc:"",user_name:"",..."edit"===r&&{prompt_code:e.prompt_code}};await eo(l)})},loading:ec,children:"add"===r?i("save"):i("update")})})]}),(0,t.jsxs)("section",{className:"flex h-full p-4 gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col flex-1 h-full overflow-y-auto pb-8",children:H.length>0?(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex-1 min-h-0 h-full",children:(0,t.jsx)(L,{value:U,onChange:et,renderHTML:e=>T.render(e),view:{html:!1,md:!0,menu:!0}})}),(0,t.jsx)("div",{className:"flex-1 min-h-0 mt-2",children:(0,t.jsx)(N.A,{title:(0,t.jsxs)(b.A,{children:[(0,t.jsx)("span",{children:"LLM OUT"}),$&&(0,t.jsx)(w.A,{message:$.msg,type:$.status,showIcon:!0})]}),className:"h-full overflow-hidden flex flex-col",styles:{body:{height:"100%",overflowY:"auto"}},children:(0,t.jsx)("div",{children:(0,t.jsx)(J,{children:null==H||null==(e=H[0])?void 0:e.context.replace(/\\n/gm,"\n")})})})})]}):(0,t.jsx)("div",{className:"h-full",children:(0,t.jsx)(L,{value:U,onChange:et,renderHTML:e=>T.render(e),view:{html:!1,md:!0,menu:!0}})})}),(0,t.jsxs)("div",{className:"flex flex-col w-2/5 pb-8 overflow-y-auto",children:[(0,t.jsx)(N.A,{className:"mb-4",children:(0,t.jsxs)(y.A,{form:Y,children:[(0,t.jsxs)("div",{className:"flex w-full gap-1 justify-between",children:[(0,t.jsx)(y.A.Item,{label:"Type",name:"prompt_type",className:"w-2/5",rules:[{required:!0,message:i("select_type")}],children:(0,t.jsx)(S.A,{options:R,placeholder:i("select_type"),allowClear:!0})}),(0,t.jsx)(y.A.Item,{name:"target",className:"w-3/5",rules:[{required:!0,message:i("select_scene")}],children:(0,t.jsx)(S.A,{loading:er,placeholder:i("select_scene"),allowClear:!0,showSearch:!0,onChange:async e=>{await ei(e)},children:null==eu?void 0:eu.map(e=>(0,t.jsx)(S.A.Option,{title:e.desc,children:e.label},e.value))})})]}),"edit"===r&&(0,t.jsx)(y.A.Item,{label:"Code",name:"prompt_code",children:(0,t.jsx)(C.A,{disabled:!0})}),(0,t.jsx)(y.A.Item,{label:"Name",name:"prompt_name",className:"m-0",rules:[{required:!0,message:i("Please_input_prompt_name")}],children:(0,t.jsx)(C.A,{placeholder:i("Please_input_prompt_name")})})]})}),(0,t.jsx)(N.A,{title:i("input_parameter"),className:"mb-4",children:(0,t.jsx)(y.A,{form:Z,children:W.length>0&&W.filter(e=>"out_schema"!==e).map(e=>(0,t.jsx)(y.A.Item,{label:e,name:e,children:(0,t.jsx)(C.A,{placeholder:i("Please_Input")})},e))})}),(0,t.jsxs)(N.A,{title:i("output_structure"),className:"flex flex-col flex-1",children:[(0,t.jsx)(h.Ay,{style:{...O,width:"100%",padding:4},className:F()({"bg-[#fafafa]":"light"===E}),value:B,enableClipboard:!1,displayDataTypes:!1,objectSortKeys:!1}),(0,t.jsx)("div",{className:"flex flex-col mt-4",children:(0,t.jsxs)(y.A,{form:Q,initialValues:{model:j,temperature:.5,prompt_language:"en"},children:[(0,t.jsx)(y.A.Item,{label:i("model"),name:"model",children:(0,t.jsx)(S.A,{className:"h-8 rounded-3xl",options:ea,allowClear:!0,showSearch:!0})}),(0,t.jsx)(y.A.Item,{label:i("temperature"),name:"temperature",children:(0,t.jsx)(M,{})}),(0,t.jsx)(y.A.Item,{label:i("language"),name:"prompt_language",children:(0,t.jsx)(S.A,{options:[{label:i("English"),value:"en"},{label:i("Chinese"),value:"zh"}]})}),(0,t.jsx)(y.A.Item,{label:i("User_input"),name:"user_input",children:(0,t.jsx)(C.A,{placeholder:i("Please_Input")})})]})}),(0,t.jsxs)(b.A,{className:"flex justify-between",children:[(0,t.jsx)(A.Ay,{type:"primary",onClick:ed,loading:K,children:i("LLM_test")}),(0,t.jsx)(A.Ay,{type:"primary",onClick:async()=>{var e;!ep&&(null==(e=H[0])?void 0:e.context)&&await em()},children:i("Output_verification")})]})]})]})]})]})}},37367:(e,l,a)=>{Promise.resolve().then(a.bind(a,21208))}},e=>{e.O(0,[823,1846,4925,6939,9595,5566,2570,5887,6174,7942,8637,1070,8441,5964,7358],()=>e(e.s=37367)),_N_E=e.O()}]);