"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5804],{39333:(e,l,t)=>{t.d(l,{A:()=>ey});var r=t(95155),a=t(29639),n=t(56196),s=t(12115),i=t(91070),o=t(53867),c=t(56939),u=t(98696),d=t(16467),p=t(29300),m=t.n(p),h=t(91218),x=t(28867),v=t(14808),y=t(75839),f=t(44421),_=t(31511),g=t(97540),j=t(66766),b=t(68250),w=t(56200),N=t(1828),A=t(76174);let k=(0,s.memo)(e=>{var l,t;let{maxNewTokensValue:a,setMaxNewTokensValue:n}=e,{appInfo:o,chatInParams:u,setChatInParams:d}=(0,s.useContext)(i.zo),{t:p}=(0,h.Bd)(),m=(0,s.useMemo)(()=>(null==u?void 0:u.filter(e=>"max_new_tokens"!==e.param_type))||[],[u]),x=(0,s.useMemo)(()=>{var e,l;return null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"max_new_tokens"===e.param_type)},[null==o||null==(l=o.layout)?void 0:l.chat_in_layout]),v=(0,s.useMemo)(()=>{var e,l;return(null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==o||null==(t=o.layout)?void 0:t.chat_in_layout]),y=(0,s.useMemo)(()=>(null==x?void 0:x.param_render_type)==="string",[null==x?void 0:x.param_render_type]);if(!v.includes("max_new_tokens"))return(0,r.jsx)(g.A,{title:p("max_new_tokens_tip"),children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(b.A,{className:"text-xl cursor-not-allowed opacity-30"})})});let f=e=>{let l=e.target.value;d([...m,{param_type:"max_new_tokens",param_value:l,sub_type:null==x?void 0:x.sub_type}]),n(l)},_=e=>{null===e||isNaN(e)||(d([...m,{param_type:"max_new_tokens",param_value:JSON.stringify(e),sub_type:null==x?void 0:x.sub_type}]),n(e))},j=e=>{isNaN(e)||(d([...m,{param_type:"max_new_tokens",param_value:JSON.stringify(e),sub_type:null==x?void 0:x.sub_type}]),n(e))};return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(w.A,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,r.jsx)("div",{className:"flex items-center gap-2",children:y?(0,r.jsx)(c.A,{size:"small",className:"w-40",placeholder:"请输入内容",onChange:f,value:"string"==typeof a?a:""}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{className:"w-32",min:1,max:20480,step:1,onChange:j,value:"number"==typeof a?a:4e3}),(0,r.jsx)(A.A,{size:"small",className:"w-20",min:1,max:20480,step:1,onChange:_,value:"number"==typeof a?a:4e3})]})}),children:(0,r.jsx)(g.A,{title:y?"IP设置":p("max_new_tokens"),placement:"bottom",arrow:!1,children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(b.A,{})})})}),(0,r.jsx)("span",{className:"text-sm ml-2",children:a})]})});var S=t(92611),C=t(32013),O=t(39508);let M=(0,s.memo)(()=>{var e,l;let{modelList:t}=(0,s.useContext)(i.UK),{appInfo:a,modelValue:n,setModelValue:o,chatInParams:c,setChatInParams:u}=(0,s.useContext)(i.zo),{t:d}=(0,h.Bd)(),p=(0,s.useMemo)(()=>(null==c?void 0:c.filter(e=>"model"!==e.param_type))||[],[c]),m=(0,s.useMemo)(()=>{var e,l;return null==a||null==(l=a.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"model"===e.param_type)},[null==a||null==(e=a.layout)?void 0:e.chat_in_layout]);return(0,s.useMemo)(()=>{var e,l;return(null==a||null==(l=a.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==a||null==(l=a.layout)?void 0:l.chat_in_layout]).includes("model")?(0,r.jsx)(C.A,{value:n,placeholder:d("choose_model"),className:"h-8 w-42 rounded-1xl",onChange:e=>{(e=>{e&&(o(e),u([...p,{param_type:"model",param_value:e,sub_type:null==m?void 0:m.sub_type}]))})(e)},popupMatchSelectWidth:300,children:t.map(e=>(0,r.jsx)(C.A.Option,{children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(O.A,{model:e}),(0,r.jsx)("span",{className:"ml-2 overflow-hidden text-ellipsis whitespace-nowrap",children:e})]})},e))}):(0,r.jsx)(g.A,{title:d("model_tip"),children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,r.jsx)(S.A,{className:"text-xl cursor-not-allowed opacity-30"})})})});var T=t(92366),P=t(3475),V=t(92197),E=t(54099),J=t(62471),I=t(27514),z=t(35695);let F=["text_file","image_file"],B=(0,s.memo)(e=>{var l,t,a,n,o,c;let{fileList:u,setFileList:d,setLoading:p,fileName:v}=e,{setResourceValue:y,appInfo:f,chatInParams:_,setChatInParams:j,refreshHistory:b,refreshDialogList:w,modelValue:N,resourceValue:A}=(0,s.useContext)(i.zo),{temperatureValue:k,maxNewTokensValue:S}=(0,s.useContext)(i.zo),O=(0,z.useSearchParams)(),M=null!=(n=null==O?void 0:O.get("scene"))?n:"",B=null!=(o=(null==O?void 0:O.get("conv_uid"))||(null==O?void 0:O.get("chatId")))?o:"",{t:R}=(0,h.Bd)(),[H,L]=(0,s.useState)([]),U=(0,s.useMemo)(()=>{var e,l;return(null==f||null==(l=f.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==f||null==(l=f.layout)?void 0:l.chat_in_layout]),W=(0,s.useMemo)(()=>{var e,l,t;return U.includes("resource")&&!F.includes(null==f||null==(t=f.layout)||null==(l=t.chat_in_layout)||null==(e=l.filter(e=>"resource"===e.param_type)[0])?void 0:e.sub_type)},[null==f||null==(t=f.layout)?void 0:t.chat_in_layout,U]),D=(0,s.useMemo)(()=>(null==_?void 0:_.filter(e=>"resource"!==e.param_type))||[],[_]),K=(0,s.useMemo)(()=>{var e,l;return null==f||null==(l=f.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"resource"===e.param_type)},[null==f||null==(a=f.layout)?void 0:a.chat_in_layout]),{run:$,loading:q}=(0,E.A)(async e=>await (0,x.Vb)((0,T.PS)([e])),{manual:!0,onSuccess:e=>{var l;let[,t]=e,r=null==t?void 0:t.find(e=>"resource"===e.param_type&&e.sub_type===(null==K?void 0:K.sub_type));r&&L(null!=(l=null==r?void 0:r.param_type_options)?l:[])}});(0,J.A)(async()=>{W&&K&&await $(K)},[W,K]);let G=(0,s.useMemo)(()=>{var e;return null==(e=H.map)?void 0:e.call(H,e=>({label:e.label,value:e.key}))},[H]);(0,s.useEffect)(()=>{if((null==_?void 0:_.length)>0&&K&&H.length>0){let e=_.find(e=>"resource"===e.param_type);e&&(null==e?void 0:e.param_value)&&((null==e?void 0:e.param_value.trim().startsWith("{"))||j([...D,{param_type:"resource",param_value:JSON.stringify(H.find(e=>e.key===A)),sub_type:null==K?void 0:K.sub_type}]))}},[_,K,H,j,A]);let Q=(0,s.useCallback)(async()=>{let e=new FormData;e.append("doc_files",null==u?void 0:u[0]),p(!0);let[l,t]=await (0,x.Vb)((0,x.o0)({convUid:B||"",chatMode:M||"chat_normal",data:e,model:N,temperatureValue:k,maxNewTokensValue:"string"==typeof S?void 0:S,config:{timeout:36e5}})).finally(()=>{p(!1)});t&&(j([...D,{param_type:"resource",param_value:JSON.stringify(t),sub_type:null==K?void 0:K.sub_type}]),y(t),await b(),w&&await w())},[B,u,N,w,b,M,p,y]);if(!U.includes("resource"))return(0,r.jsx)(g.A,{title:R("extend_tip"),children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,r.jsx)(P.A,{className:"text-lg cursor-not-allowed opacity-30"})})});switch(null==K?void 0:K.sub_type){case"text_file":case"image_file":case"common_file":return(0,r.jsx)(I.A,{name:"file",accept:(e=>{switch(e){case"text_file":return".txt,.doc,.docx,.pdf,.md";case"image_file":return".jpg,.jpeg,.png,.gif,.bmp,.webp";case"audio_file":return".mp3,.wav,.ogg,.aac";case"video_file":return".mp4,.wav,.wav";default:return""}})(null==K?void 0:K.sub_type),fileList:u,showUploadList:!1,beforeUpload:(e,l)=>{null==d||d(l)},customRequest:Q,disabled:!!v,children:(0,r.jsx)(g.A,{title:R("file_tip"),arrow:!1,placement:"bottom",children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,r.jsx)(V.A,{className:m()("text-xl",{"cursor-pointer":!(v||(null==(c=u[0])?void 0:c.name))})})})})});default:return(0,r.jsx)(C.A,{value:A,className:"w-30 h-8 rounded-3xl",onChange:e=>{(e=>{e&&(y(e),j([...D,{param_type:"resource",param_value:JSON.stringify(H.find(l=>l.key===e)),sub_type:null==K?void 0:K.sub_type}]))})(e)},disabled:!!(null==K?void 0:K.bind_value),loading:q,options:G})}}),R=(0,s.memo)(e=>{var l,t;let{temperatureValue:a,setTemperatureValue:n}=e,{appInfo:o,chatInParams:c,setChatInParams:u}=(0,s.useContext)(i.zo),{t:d}=(0,h.Bd)(),p=(0,s.useMemo)(()=>(null==c?void 0:c.filter(e=>"model"!==e.param_type))||[],[c]),m=(0,s.useMemo)(()=>{var e,l;return null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"temperature"===e.param_type)},[null==o||null==(l=o.layout)?void 0:l.chat_in_layout]);if(!(0,s.useMemo)(()=>{var e,l;return(null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==o||null==(t=o.layout)?void 0:t.chat_in_layout]).includes("temperature"))return(0,r.jsx)(g.A,{title:d("temperature_tip"),children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(b.A,{className:"text-xl cursor-not-allowed opacity-30"})})});let x=e=>{isNaN(e)||(u([...p,{param_type:"temperature",param_value:JSON.stringify(e),sub_type:null==m?void 0:m.sub_type}]),n(e))};return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(w.A,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(N.A,{className:"w-20",min:0,max:1,step:.1,onChange:x,value:"number"==typeof a?a:0}),(0,r.jsx)(A.A,{size:"small",className:"w-14",min:0,max:1,step:.1,onChange:x,value:a})]}),children:(0,r.jsx)(g.A,{title:d("temperature"),placement:"bottom",arrow:!1,children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(b.A,{})})})}),(0,r.jsx)("span",{className:"text-sm ml-2",children:a})]})});var H=t(40010);let L=(0,s.memo)(e=>{var l,t;let{faultTypeValue:a,setFaultTypeValue:n}=e,{appInfo:o,chatInParams:c,setChatInParams:u}=(0,s.useContext)(i.zo),{t:d}=(0,h.Bd)(),[p,m]=(0,s.useState)(!1),x=(0,s.useMemo)(()=>(null==c?void 0:c.filter(e=>"fault_type"!==e.param_type))||[],[c]),v=(0,s.useMemo)(()=>{var e,l;return null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"fault_type"===e.param_type)},[null==o||null==(l=o.layout)?void 0:l.chat_in_layout]),y=(0,s.useMemo)(()=>{var e,l;return(null==o||null==(l=o.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==o||null==(t=o.layout)?void 0:t.chat_in_layout]),f=(0,s.useMemo)(()=>{var e;return console.log("故障类型调试信息:",{appInfo:o,chat_in_layout:null==o||null==(e=o.layout)?void 0:e.chat_in_layout,fault_type:v,param_type_options:null==v?void 0:v.param_type_options}),(null==v?void 0:v.param_type_options)||[]},[null==v?void 0:v.param_type_options,o]);if(!y.includes("fault_type"))return(0,r.jsx)(g.A,{title:"故障类型",children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(H.A,{className:"text-xl cursor-not-allowed opacity-30"})})});let _=(0,r.jsxs)("div",{className:"w-64 p-2",children:[(0,r.jsx)("div",{className:"mb-2 text-sm font-medium",children:"选择故障类型"}),(0,r.jsx)(C.A,{value:a,onChange:e=>{n(e),u([...x,{param_type:"fault_type",param_value:e,sub_type:""}]),m(!1)},options:f,placeholder:"请选择故障类型",className:"w-full",size:"middle"})]});return(0,r.jsx)(w.A,{content:_,title:null,trigger:"click",open:p,onOpenChange:m,placement:"topLeft",arrow:!1,children:(0,r.jsx)(g.A,{title:"故障类型",placement:"bottom",children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,r.jsx)(H.A,{className:"text-xl ".concat(a?"text-[#0c75fc]":"")})})})})});var U=t(47937);let W=(0,s.memo)(e=>{var l,t;let{ctrl:a}=e,{t:n}=(0,h.Bd)(),{history:c,scrollRef:u,canAbort:p,replyLoading:b,currentDialogue:w,appInfo:N,temperatureValue:A,maxNewTokensValue:S,resourceValue:C,faultTypeValue:O,setTemperatureValue:T,setMaxNewTokensValue:P,setFaultTypeValue:V,refreshHistory:E,setCanAbort:J,setReplyLoading:I,handleChat:F,chatInParams:H,setChatInParams:W,setResourceValue:D}=(0,s.useContext)(i.zo),[K,$]=(0,s.useState)([]),[q,G]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),Y=(0,z.useSearchParams)(),Z=null!=(t=null==Y?void 0:Y.get("conv_uid"))?t:"",ee=(0,s.useMemo)(()=>{var e,l;return(null==N||null==(l=N.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==N||null==(l=N.layout)?void 0:l.chat_in_layout]),el=(0,s.useMemo)(()=>[{tip:n("stop_replying"),icon:(0,r.jsx)(v.A,{className:m()({"text-[#0c75fc]":p})}),can_use:p,key:"abort",onClick:()=>{p&&((0,x.vc)({conv_session_id:Z}),a&&a.abort(),setTimeout(()=>{J(!1),I(!1)},100))}},{tip:n("answer_again"),icon:(0,r.jsx)(y.A,{}),can_use:!b&&c.length>0,key:"redo",onClick:async()=>{var e,l;let t=null==(l=c.filter(e=>"human"===e.role))||null==(e=l.slice(-1))?void 0:e[0];F((null==t?void 0:t.context)||"",{app_code:N.app_code,...ee.length&&{chat_in_params:H}}),setTimeout(()=>{var e,l;null==(l=u.current)||l.scrollTo({top:null==(e=u.current)?void 0:e.scrollHeight,behavior:"smooth"})},0)}},{tip:n("erase_memory"),icon:Q?(0,r.jsx)(d.A,{spinning:Q,indicator:(0,r.jsx)(o.A,{style:{fontSize:20}})}):(0,r.jsx)(f.A,{}),can_use:c.length>0,key:"clear",onClick:async()=>{Q||(X(!0),await (0,x.Vb)((0,x.CK)(Z)).finally(async()=>{await E(),X(!1)}))}}],[n,p,b,c,Q,a,J,I,F,N.app_code,ee,A,C,null==w?void 0:w.select_param,null==w?void 0:w.conv_uid,u,E]),et=(0,s.useMemo)(()=>{try{if(C)if("string"==typeof C)return JSON.parse(C).file_name||"";else return C.file_name||""}catch(e){return""}},[C]);return(0,r.jsxs)("div",{className:"flex flex-col  mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between h-full w-full",children:[(0,r.jsxs)("div",{className:"flex gap-3 text-lg",children:[(0,r.jsx)(M,{}),(0,r.jsx)(B,{fileList:K,setFileList:$,setLoading:G,fileName:et}),(0,r.jsx)(R,{temperatureValue:A,setTemperatureValue:T}),(0,r.jsx)(k,{maxNewTokensValue:S,setMaxNewTokensValue:P}),(0,r.jsx)(L,{faultTypeValue:O,setFaultTypeValue:V})]}),(0,r.jsx)("div",{className:"flex gap-1",children:(0,r.jsx)(r.Fragment,{children:el.map(e=>(0,r.jsx)(g.A,{title:e.tip,arrow:!1,placement:"bottom",children:(0,r.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] text-lg ".concat(e.can_use?"cursor-pointer":"opacity-30 cursor-not-allowed"),onClick:()=>{var l;null==(l=e.onClick)||l.call(e)},children:e.icon})},e.key))})})]}),(0,r.jsx)(()=>{var e;let l=C&&(0,U.nr)(C)||[];if(0===l.length)return null;let t=(0,s.useMemo)(()=>(null==H?void 0:H.filter(e=>"resource"!==e.param_type))||[],[H]),a=(0,s.useMemo)(()=>{var e,l;return null==N||null==(l=N.layout)||null==(e=l.chat_in_layout)?void 0:e.find(e=>"resource"===e.param_type)},[null==N||null==(e=N.layout)?void 0:e.chat_in_layout]);return(0,r.jsx)("div",{className:"group/item flex flex-wrap gap-2 mt-2",children:l.map((e,l)=>{var n,s;let i=()=>{D(null);let e=H.find(e=>"resource"===e.param_type);e&&(null==e?void 0:e.param_value)&&W([...t,{param_type:"resource",param_value:"",sub_type:null==a?void 0:a.sub_type}])};if("image_url"===e.type&&(null==(n=e.image_url)?void 0:n.url))return(e=>{let{item:l,handleDelete:t,index:a}=e,n=l.image_url.file_name,s=(0,U.sC)(l.image_url.url);return s?(0,r.jsxs)("div",{className:"relative flex flex-col border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:[(0,r.jsx)("span",{className:"absolute top-[-2px] right-[1] cursor-pointer z-10 text-gray-500",onClick:t,title:"删除",children:(0,r.jsx)(_.A,{})}),(0,r.jsx)("div",{className:"w-32 h-32 mb-2 overflow-hidden flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded",children:(0,r.jsx)("img",{src:s,alt:n||"Preview",className:"max-w-full max-h-full object-contain"})}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:n})})]},"img-".concat(a)):null})({item:e,handleDelete:i,index:l});if("file_url"===e.type&&(null==(s=e.file_url)?void 0:s.url)){let t=e.file_url.file_name;return(0,r.jsxs)("div",{className:"relative flex items-center justify-between border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg py-2 px-3",children:[(0,r.jsx)("span",{className:"absolute top-[-2px] right-[1] cursor-pointer z-10 text-gray-500",onClick:i,title:"删除",children:(0,r.jsx)(_.A,{})}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(j.default,{src:"/icons/chat/file.png",width:20,height:20,alt:"file-icon",className:"mr-2"}),(0,r.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:t})]})]},"file-".concat(l))}return null})})},{}),(0,r.jsx)(d.A,{spinning:q,indicator:(0,r.jsx)(o.A,{style:{fontSize:24},spin:!0})})]})});var D=t(71740);let K=(0,s.memo)(e=>{var l;let{ctrl:t}=e,{t:a}=(0,h.Bd)(),{scrollRef:n,replyLoading:p,handleChat:x,appInfo:v,resourceValue:y,refreshDialogList:f,chatInParams:_,setResourceValue:g}=(0,s.useContext)(i.zo),[j,b]=(0,s.useState)(""),[w,N]=(0,s.useState)(!1),[A,k]=(0,s.useState)(!1),S=(0,s.useRef)(0),C=(0,s.useMemo)(()=>{var e,l;return(null==v||null==(l=v.layout)||null==(e=l.chat_in_layout)?void 0:e.map(e=>e.param_type))||[]},[null==v||null==(l=v.layout)?void 0:l.chat_in_layout]),O=async()=>{var e,l;let t;if(S.current++,setTimeout(()=>{var e,l;null==(l=n.current)||l.scrollTo({top:null==(e=n.current)?void 0:e.scrollHeight,behavior:"smooth"}),b("")},0),D.O.includes(null!=(l=null==(e=_.find(e=>"resource"===e.param_type))?void 0:e.sub_type)?l:"")){g(y||null);let e=[...(0,U.nr)(y)];e.push({type:"text",text:j}),t={role:"user",content:e}}else t=j;await x(t,{app_code:v.app_code||"",...C.length&&{chat_in_params:_}}),1===S.current&&f&&await f()};return(0,r.jsx)("div",{className:"flex flex-col w-full mx-auto pt-4 pb-0 bg-transparent",children:(0,r.jsxs)("div",{className:"flex flex-1 flex-col bg-white dark:bg-[rgba(255,255,255,0.16)] px-5 py-4 pt-2 rounded-xl relative border border-[#E0E7F2] dark:border-[rgba(255,255,255,0.6)] ".concat(w?"border-[#0c75fc]":""),id:"input-panel",children:[(0,r.jsx)(W,{ctrl:t}),(0,r.jsx)(c.A.TextArea,{placeholder:a("input_tips"),className:"w-full h-10 resize-none border-0 p-0 focus:shadow-none dark:bg-transparent",value:j,onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||A||(e.preventDefault(),j.trim()&&!p&&O()))},onChange:e=>{b(e.target.value)},onFocus:()=>{N(!0)},onBlur:()=>N(!1),onCompositionStart:()=>k(!0),onCompositionEnd:()=>k(!1)}),(0,r.jsx)(u.Ay,{type:"primary",className:m()("flex items-center justify-center w-14 h-8 rounded-lg text-sm absolute right-4 bottom-3 bg-button-gradient border-0",{"cursor-not-allowed":!j.trim()}),onClick:()=>{!p&&j.trim()&&O()},children:p?(0,r.jsx)(d.A,{spinning:p,indicator:(0,r.jsx)(o.A,{className:"text-white"})}):a("sent")})]})})});var $=t(78966),q=t.n($),G=t(51368),Q=t(91573),X=t(37974),Y=t(69068),Z=t.n(Y),ee=t(76572),el=t(55887);let et=e=>{var l;let{isScrollToTop:t}=e,{message:a}=el.A.useApp(),{appInfo:n,refreshAppInfo:o}=(0,s.useContext)(i.zo),{t:c}=(0,h.Bd)(),u=(0,s.useMemo)(()=>{var e;return(null==n||null==(e=n.team_context)?void 0:e.chat_scene)||"chat_agent"},[n]),d=(0,s.useMemo)(()=>(null==n?void 0:n.icon)||"",[n]),p=(0,s.useMemo)(()=>(null==n?void 0:n.is_collected)==="true",[n]),{run:m,loading:v}=(0,E.A)(async()=>{let[e]=await (0,x.Vb)(p?(0,x.bQ)({app_code:n.app_code}):(0,x.cT)({app_code:n.app_code}));if(!e)return await o()},{manual:!0});if((0,s.useMemo)(()=>{var e;return(null==(e=n.param_need)?void 0:e.map(e=>e.type))||[]},[n.param_need]),!Object.keys(n).length)return null;let y=async()=>{let e=Z()(location.href);a[e?"success":"error"](e?c("copy_success"):c("copy_failed"))};return(0,r.jsx)("div",{className:"mt-1 mb-4 bg-[#E0E7F2] ".concat((null==n?void 0:n.recommend_questions)&&(null==n||null==(l=n.recommend_questions)?void 0:l.length)>0?"mb-4":""," sticky top-0 bg-transparent z-30 transition-all duration-400 ease-in-out shadow-[0_4px_12px_-4px_rgba(0,0,0,0.08)]"),children:(()=>{var e,l;return(0,r.jsxs)("header",{className:"flex items-center justify-between w-full h-14 bg-[#F1F5F9] dark:bg-[rgba(41,63,89,0.4)]  px-8 transition-all duration-500 ease-in-out py-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-2 bg-white",children:d?(0,r.jsx)("img",{src:d,alt:null==n?void 0:n.app_name,className:"w-8 min-w-8 rounded-full max-w-none"}):(0,r.jsx)(ee.A,{scene:u,width:16,height:16})}),(0,r.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,r.jsx)("span",{children:null==n?void 0:n.app_name}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(null==n?void 0:n.team_mode)&&(0,r.jsx)(X.A,{color:"green",children:null==n?void 0:n.team_mode}),(null==n||null==(e=n.team_context)?void 0:e.chat_scene)&&(0,r.jsx)(X.A,{color:"cyan",children:null==n||null==(l=n.team_context)?void 0:l.chat_scene})]})]})]}),(0,r.jsx)("div",{className:"flex gap-8",onClick:async()=>{await m()},children:(0,r.jsx)(Q.A,{className:"text-lg",onClick:e=>{e.stopPropagation(),y()}})})]})})()})};var er=t(66551),ea=t(81702),en=t(3231),es=t(91479),ei=t(45163),eo=t(92199);let ec=()=>{var e;let l=JSON.parse(null!=(e=localStorage.getItem(ea.Gm))?e:""),t=(null==l?void 0:l.avatar_url)||"/agents/sre.png";return(0,r.jsx)(j.default,{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:32,height:32,src:t,alt:"User Avatar"})},eu={todo:{bgClass:"bg-gray-500",icon:(0,r.jsx)(en.A,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,r.jsx)(o.A,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,r.jsx)(es.A,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,r.jsx)(ei.A,{className:"ml-2"})}},ed=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"),ep=(0,s.memo)(e=>{let{content:l,onLinkClick:t,messages:a}=e,{t:n}=(0,h.Bd)(),{context:i,role:o,thinking:c}=l,u=(0,s.useMemo)(()=>"view"===o,[o]),{value:d,cachePluginContext:p}=(0,s.useMemo)(()=>{if("string"!=typeof i)return{relations:[],value:"",cachePluginContext:[]};let[e,l]=i.split("	relations:"),t=l?l.split(","):[],r=[],a=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var l;let t=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(t),s="<custom-view>".concat(a,"</custom-view>");return r.push({...n,result:ed(null!=(l=n.result)?l:"")}),a++,s}catch(l){return console.log(l.message,l),e}});return{relations:t,cachePluginContext:r,value:n}},[i]),x=(0,s.useMemo)(()=>({"custom-view"(e){var l;let{children:t}=e,a=+t.toString();if(!p[a])return t;let{name:n,status:s,err_msg:i,result:o}=p[a],{bgClass:c,icon:u}=null!=(l=eu[s])?l:{};return(0,r.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,r.jsxs)("div",{className:m()("flex px-4 md:px-6 py-2 items-center text-white text-sm",c),children:[n,u]}),o?(0,r.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,r.jsx)(eo.A,{components:er.Ay,...er.iU,children:(0,er.Jg)(null!=o?o:"")})}):(0,r.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:i})]})}}),[p]),v=function(e){try{return JSON.parse(e)}catch(e){return{left:"",right:""}}}(i),y=null==v?void 0:v.planning_window,f=void 0!==y?y:d;return(0,r.jsxs)(r.Fragment,{children:[!u&&(0,r.jsxs)("div",{className:"flex flex-1 justify-end items-start pb-4",style:{gap:12},children:[(0,r.jsx)("span",{className:"break-words text-right",style:{maxWidth:"100%",minWidth:0},children:"string"==typeof i?(0,r.jsx)("div",{className:"flex-1 text-sm text-[#1c2533] dark:text-white",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:"string"==typeof i&&(0,r.jsx)("div",{children:(0,r.jsx)(eo.A,{components:{...er.Ay,img:e=>{let{src:l,alt:t,...a}=e;return(0,r.jsx)("img",{src:l,alt:t||"image",className:"max-w-full md:max-w-[80%] lg:max-w-[70%] object-contain",style:{maxHeight:"200px"},...a})}},...er.iU,children:(0,er.Jg)(ed(d))})})}):(null==i?void 0:i.template_introduce)||""}),(0,r.jsx)(ec,{})]}),u&&(0,r.jsxs)("div",{className:"flex flex-col pr-2 border-dashed border-r0 flex-1",children:[(0,r.jsx)(eo.A,{components:{...er.Ay,...x},...er.iU,children:(0,er.Jg)((e=>null==e?void 0:e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"))(f))}),c&&!i&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:n("thinking")}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,r.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,r.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]})]})]})}),em=(0,s.memo)(e=>{var l;let{ctrl:t}=e,a=(0,s.useRef)(null),{history:n,isDebug:o,isShowDetail:c}=(0,s.useContext)(i.zo),[u,d]=(0,s.useState)(!1),[p,m]=(0,s.useState)(""),h=(0,s.useMemo)(()=>q()(n).filter(e=>["view","human"].includes(e.role)).map(e=>({...e,key:(0,G.A)()})),[n]);return(0,s.useEffect)(()=>{setTimeout(()=>{var e,l;null==(l=a.current)||l.scrollTo(0,null==(e=a.current)?void 0:e.scrollHeight)},50)},[n,null==(l=n[n.length-1])?void 0:l.context]),console.log("Rendering content3...",t),(0,r.jsx)("div",{className:"flex flex-1 h-full",children:(0,r.jsx)("div",{className:"".concat(o?"bg-[transparent]":"bg-white"," dark:bg-[rgba(255,255,255,0.16)] flex flex-1 flex-col p-2 items-center relative"),ref:a,children:(0,r.jsxs)("div",{className:"flex flex-col flex-1 ".concat(c?"w-3/5":"w-full"," h-full"),children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-scroll",children:[(0,r.jsx)(et,{isScrollToTop:!0}),!!h.length&&h.map((e,l)=>(0,r.jsx)(ep,{content:e,onLinkClick:()=>{d(!0),m(JSON.stringify(null==e?void 0:e.context,null,2))},messages:h},l))]}),(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(K,{ctrl:t})})})]})})})});var eh=t(70061);let ex=(0,s.memo)(e=>{let{content:l}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"flex flex-col border-dashed border-r0 flex-1 h-full",children:(0,r.jsx)(eo.A,{components:{...er.Ay},...er.iU,children:l})})})}),ev=(0,s.memo)(e=>{var l;let{ctrl:t}=e,a=(0,s.useRef)(null),n=(0,s.useRef)(null),{history:o,isShowDetail:c,isDebug:u}=(0,s.useContext)(i.zo),{runningWindowMarkdown:d}=function(e){let[l,t]=(0,s.useState)("");return(0,s.useEffect)(()=>{if(!Array.isArray(e))return void t("");let l="";for(let t of e)try{if("string"==typeof t.context&&!t.context.trim().startsWith("{"))continue;let e=("string"==typeof t.context?JSON.parse(t.context):t.context).running_window||"";e&&"string"==typeof e&&(l=l?(0,eh.cc)(l,e||""):e||"")}catch(e){console.debug("Skipping invalid chat item context:",{error:e instanceof Error?e.message:String(e),itemId:(null==t?void 0:t.id)||(null==t?void 0:t.order),contextSample:"string"==typeof(null==t?void 0:t.context)?t.context.substring(0,50):"[non-string context]"})}t(l)},[e]),{runningWindowMarkdown:l}}(o),[p,m]=(0,s.useState)(!1),[h,x]=(0,s.useState)(""),v=(0,s.useMemo)(()=>q()(o).filter(e=>["view","human"].includes(e.role)).map(e=>({...e,key:(0,G.A)()})),[o]);return(0,s.useEffect)(()=>{setTimeout(()=>{var e,l;null==(l=a.current)||l.scrollTo(0,null==(e=a.current)?void 0:e.scrollHeight)},50)},[o,null==(l=o[o.length-1])?void 0:l.context]),(0,r.jsx)("div",{className:"flex flex-1 h-full w-full ",children:(0,r.jsxs)("div",{className:"".concat(u?"bg-[transparent]":"bg-white","  dark:bg-[rgba(255,255,255,0.16)] flex flex-1 p-2 justify-center flex-1 w-full"),children:[(0,r.jsxs)("div",{className:"flex flex-col w-2/5 pr-2 border-gray-300 flex-1",children:[(0,r.jsxs)("div",{className:"h-full flex-1 overflow-y-scroll",ref:n,children:[(0,r.jsx)(et,{isScrollToTop:!0}),!!v.length&&v.map((e,l)=>(0,r.jsx)(ep,{content:e,onLinkClick:()=>{m(!0),x(JSON.stringify(null==e?void 0:e.context,null,2))},messages:v},l))]}),(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsx)(K,{ctrl:t})})]}),c&&(0,r.jsx)("div",{className:"flex flex-col w-3/5 pl-2 border-dashed border-l border-[#F1F5F9] h-full",id:"running-window",children:(0,r.jsx)(ex,{content:d})})]})})}),ey=(0,s.memo)((0,s.forwardRef)((e,l)=>{var t,o,c,u;let{ctrl:d}=e,{appInfo:p}=(0,s.useContext)(i.zo),m=(0,s.useRef)(null),[h,x]=(0,s.useState)(!1),[v,y]=(0,s.useState)(!1),[f,_]=(0,s.useState)(!0),[g,j]=(0,s.useState)(!1);(0,s.useImperativeHandle)(l,()=>m.current);let b=()=>{if(!m.current)return;let e=m.current,l=e.scrollTop,t=e.scrollHeight,r=e.clientHeight;_(l<=20),j(l+r>=t-20),l>=74?x(!0):x(!1),y(t>r)};(0,s.useEffect)(()=>(m.current&&(m.current.addEventListener("onScroll",b),y(m.current.scrollHeight>m.current.clientHeight)),()=>{m.current&&m.current.removeEventListener("onScroll",b)}),[]);let w=(0,s.useMemo)(()=>{var e,l,t,r;return(null==p||null==(l=p.layout)||null==(e=l.chat_layout)?void 0:e.reuse_name)==="derisk_vis_window"||(null==p||null==(r=p.layout)||null==(t=r.chat_layout)?void 0:t.name)==="derisk_vis_window"},[null==p||null==(o=p.layout)||null==(t=o.chat_layout)?void 0:t.name,null==p||null==(u=p.layout)||null==(c=u.chat_layout)?void 0:c.reuse_name]);return(0,r.jsxs)("div",{className:"flex flex-1 relative h-full",children:[(0,r.jsx)("div",{ref:m,className:"h-full w-full flex-1 flex flex-col overflow-hidden",children:w?(0,r.jsx)(ev,{ctrl:d}):(0,r.jsx)(em,{ctrl:d})}),v&&(0,r.jsxs)("div",{className:"absolute right-6 bottom-24 flex flex-col gap-2",children:[!f&&(0,r.jsx)("button",{onClick:()=>{m.current&&m.current.scrollTo({top:0,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to top",children:(0,r.jsx)(a.A,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})}),!g&&(0,r.jsx)("button",{onClick:()=>{m.current&&m.current.scrollTo({top:m.current.scrollHeight,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to bottom",children:(0,r.jsx)(n.A,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})})]})]})}))},70061:(e,l,t)=>{t.d(l,{cc:()=>y,yh:()=>_});var r=t(97124),a=t.n(r),n=t(60363),s=t.n(n),i=t(71965),o=t(94793),c=t(96705),u=t(54514),d=t(36174);let p=(e,l)=>(function(e){let l=(null==e?void 0:e.remarkPlugins)||[],t={allowDangerousHtml:!0,...null==e?void 0:e.remarkRehypeOptions};return(0,u.l)().use(i.A).use(l).use(c.A,t)})(l).parse(function(e){let l=e.children||"",t=new d.T;return"string"==typeof l?t.value=l:console.error("Unexpected value `"+l+"` for `children` prop, expected `string`"),t}({children:e})),m=e=>(0,u.l)().use(o.A).stringify(e).trimEnd(),h=(e,l,t)=>{let r,{markdown:n="",uid:i,type:o,items:c=[],dynamic:u}=e,{markdown:d="",uid:p,type:m,items:x=[],dynamic:v}=l;if(i!==p)return e;let f=u?n+d:y(n,d,t);if(r="all"===m?d:"incr"===o||d?f:n,0!==x.length){let n=x.filter(e=>!a()(c,{uid:e.uid})),o=s()(x,"uid"),u=c.map(e=>o[e.uid]?h(e,o[e.uid],t):e);return{...e,...l,markdown:r||void 0,uid:i,dynamic:v,type:m,items:[...u,...n]}}return{...e,...l,markdown:r,uid:i,dynamic:v,type:m,items:c}},x=(e,l,t)=>{let r=t||(e=>{let l=new Map,t=e=>{let r=e=>{l.set(e.uid,e),e.markdown&&t(p(e.markdown)),e.items&&e.items.forEach(e=>{e.markdown&&t(p(e.markdown))})};if(e.hasOwnProperty("children"))e.children&&e.children.forEach(e=>t(e));else if(e.hasOwnProperty("lang")&&e.value)try{let l=JSON.parse(e.value);(l.items||[]).forEach(e=>{r(e)}),r(l)}catch(e){}};return t(e),l})(l),a=e=>{if(e.hasOwnProperty("children"))e.children.map(e=>a(e));else if(e.hasOwnProperty("lang")&&e.value)try{let l=JSON.parse(e.value),t=r.get(l.uid),a=t?h(l,t):l;e.value=JSON.stringify(a)}catch(e){}return e};return a(e),e},v=e=>{let l=e.match(/`/g);return!l||l.length<6},y=(e,l,t)=>{if(!e||!l)return e||l||void 0;if(v(e)||v(l)||!e.includes("```")&&!l.includes("```"))return e+l;let r=p(e),a=p(l);return r.hasOwnProperty("children")&&a.hasOwnProperty("children")?((e,l,t)=>{if(e.hasOwnProperty("children")&&l.hasOwnProperty("children")){let r=JSON.stringify(e);l.children.forEach(l=>{if(l.hasOwnProperty("lang")&&l.value)try{let a=JSON.parse(l.value).uid;if(r.includes(a)){let r=e.children.find(e=>{var l;return null==(l=e.value)?void 0:l.includes(a)});if(r){let e=x(r,l,t);r.value=e.value}}else e.children.push(l)}catch(e){}})}return m(e)})(r,a,t):m(x(r,a,t))};class f{destroy(){var e;null==(e=this.incrNodesMap)||e.clear()}createFile(e){let l=e.children||"",t=new d.T;return"string"==typeof l?t.value=l:console.error("Unexpected value `"+l+"` for `children` prop, expected `string`"),t}createTree2StringProcessor(){return(0,u.l)().use(o.A)}createString2TreeProcessor(e){let l=(null==e?void 0:e.remarkPlugins)||[],t={allowDangerousHtml:!0,...null==e?void 0:e.remarkRehypeOptions};return(0,u.l)().use(i.A).use(l).use(c.A,t)}parseVis2AST(e){return this.string2TreeProcessor.parse(this.createFile({children:e}))}parseAST2Vis(e){return this.tree2StringProcessor.stringify(e).trimEnd()}combineVisItem(e,l){let t,{markdown:r="",uid:n,type:i,items:o=[],dynamic:c}=e,{markdown:u="",uid:d,type:p,items:m=[],dynamic:h}=l;if(n!==d)return e;let x=c?r+u:this.combineMarkdownString(r,u);if(t="all"===p?u:"incr"===i||u?x:r,0!==m.length){let r=m.filter(e=>!a()(o,{uid:e.uid})),i=s()(m,"uid"),c=o.map(e=>i[e.uid]?this.combineVisItem(e,i[e.uid]):e);return{...e,...l,markdown:t||void 0,uid:n,dynamic:h,type:p,items:[...c,...r]}}return{...e,...l,markdown:t,uid:n,dynamic:h,type:p,items:o}}getIncrContent(e){this.incrNodesMap.clear();let l=e=>{let t=e=>{this.incrNodesMap.set(e.uid,e),e.markdown&&l(this.parseVis2AST(e.markdown)),e.items&&e.items.forEach(e=>{e.markdown&&l(this.parseVis2AST(e.markdown))})};if(e.hasOwnProperty("children"))e.children&&e.children.forEach(e=>l(e));else if(e.hasOwnProperty("lang")&&e.value)try{let l=JSON.parse(e.value);(l.items||[]).forEach(e=>{t(e)}),t(l)}catch(e){}};l(e)}updateAST(e){let l=e=>{if(e.hasOwnProperty("children"))e.children.map(e=>l(e));else if(e.hasOwnProperty("lang")&&e.value)try{let l=JSON.parse(e.value),t=this.incrNodesMap.get(l.uid),r=t?this.combineVisItem(l,t):l;e.value=JSON.stringify(r)}catch(e){}return e};return l(e),e}isPartialTag(e){let l=e.match(/`/g);return!l||l.length<6}combineNodeWithChildren(e,l){if(e.hasOwnProperty("children")&&l.hasOwnProperty("children")){let t=JSON.stringify(e);l.children.forEach(l=>{if(l.hasOwnProperty("lang")&&l.value)try{let r=JSON.parse(l.value).uid;if(t.includes(r)){let l=e.children.find(e=>{var l;return null==(l=e.value)?void 0:l.includes(r)});if(l){let e=this.updateAST(l);l.value=e.value}}else e.children.push(l)}catch(e){}})}return this.parseAST2Vis(e)}combineMarkdownString(e,l){if(!e||!l)return e||l||void 0;if(this.isPartialTag(e)||this.isPartialTag(l)||!e.includes("```")&&!l.includes("```"))return e+l;let t=this.parseVis2AST(e),r=this.parseVis2AST(l);if(t.hasOwnProperty("children")&&r.hasOwnProperty("children"))return this.combineNodeWithChildren(t,r);let a=this.updateAST(t);return this.parseAST2Vis(a)}updateCurrentMarkdown(e){if(!this.currentVis)return this.currentVis=e,this.currentVis;let l=this.parseVis2AST(e);this.getIncrContent(l);let t=this.combineMarkdownString(this.currentVis,e);return this.currentVis=t||"",this.currentVis}constructor(){this.incrNodesMap=new Map,this.string2TreeProcessor=this.createString2TreeProcessor(),this.tree2StringProcessor=this.createTree2StringProcessor(),this.currentVis=""}}class _{getCurrent(e){var l;return e?(null==(l=this.parsers.get(e))?void 0:l.current)||"":this.defaultParser.currentVis}update(e){try{let l=JSON.parse(e);Object.keys(l).forEach(e=>{let t=this.parsers.get(e);if(t)t.update(l[e]),l[e]=t.current;else{let t=new _;t.update(l[e]),this.parsers.set(e,t)}}),this.current=JSON.stringify(l)}catch(l){this.defaultParser.updateCurrentMarkdown(e),this.current=this.defaultParser.currentVis}return this.current}destroy(){this.parsers.clear()}constructor(){this.current="",this.parsers=new Map,this.defaultParser=new f}}},71740:(e,l,t)=>{t.d(l,{A:()=>d,O:()=>u});var r=t(95155),a=t(19361),n=t(74947),s=t(32570),i=t(32013),o=t(56939),c=t(12115);let u=["image_file","video_file","text_file","common_file"],d=c.memo(function(e){let{form:l,selectedChatConfigs:t,chatConfigOptions:c,onInputBlur:d,resourceOptions:p,modelOptions:m}=e;if(!t||0===t.length)return null;let h={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"};return(0,r.jsx)(r.Fragment,{children:null==t?void 0:t.map(e=>{var t,x=null==c?void 0:c.find(l=>l.param_type===e);if(!x)return null;switch(x.param_type){case"model":return(0,r.jsxs)(a.A,{gutter:24,children:[(0,r.jsx)(n.A,{span:14,children:(0,r.jsx)(s.A.Item,{label:(0,r.jsx)("span",{style:h,title:x.param_description,children:x.param_description}),name:x.param_type,labelCol:{flex:"80px"},children:(0,r.jsx)(i.A,{className:"h-10",options:(null==(t=x.sub_types)?void 0:t.map(e=>({value:e,label:e})))||[],disabled:!x.sub_types,placeholder:"请选择".concat(x.param_description),onBlur:()=>d("".concat(x.param_type,"_value"))})})},"".concat(x.param_type,"-col1")),(0,r.jsx)(n.A,{span:10,children:(0,r.jsx)(s.A.Item,{name:"".concat(x.param_type,"_value"),initialValue:x.param_default_value,children:(0,r.jsx)(i.A,{options:m,placeholder:"请输入".concat(x.param_description),className:"h-10 flex-1"})})},"".concat(x.param_type,"-col2"))]},x.param_type);case"temperature":return(0,r.jsxs)(a.A,{gutter:24,children:[(0,r.jsx)(n.A,{span:14,children:(0,r.jsx)(s.A.Item,{label:(0,r.jsx)("span",{style:h,title:x.param_description,children:x.param_description}),name:x.param_type,labelCol:{flex:"80px"},children:(0,r.jsx)(o.A,{type:"number",step:"0.01",disabled:!x.sub_types,placeholder:"请输入".concat(x.param_description),className:"h-10"})})},"".concat(x.param_type,"-col1")),(0,r.jsx)(n.A,{span:10,children:(0,r.jsx)(s.A.Item,{name:"".concat(x.param_type,"_value"),initialValue:x.param_default_value,children:(0,r.jsx)(o.A,{type:"number",step:"0.01",placeholder:"请输入".concat(x.param_description),className:"h-10",onBlur:()=>d("".concat(x.param_type,"_value"))})})},"".concat(x.param_type,"-col2"))]},x.param_type);case"max_new_tokens":return(0,r.jsxs)(a.A,{gutter:24,children:[(0,r.jsx)(n.A,{span:14,children:(0,r.jsx)(s.A.Item,{label:(0,r.jsx)("span",{style:h,title:x.param_description,children:x.param_description}),name:x.param_type,labelCol:{flex:"80px"},children:(0,r.jsx)(o.A,{type:"text",disabled:!x.sub_types,placeholder:"请输入".concat(x.param_description),className:"h-10"})})},"".concat(x.param_type,"-col1")),(0,r.jsx)(n.A,{span:10,children:(0,r.jsx)(s.A.Item,{name:"".concat(x.param_type,"_value"),initialValue:x.param_default_value,children:(0,r.jsx)(o.A,{type:"text",placeholder:"请输入".concat(x.param_description),className:"h-10",onBlur:()=>d("".concat(x.param_type,"_value"))})})},"".concat(x.param_type,"-col2"))]},x.param_type);case"resource":return(0,r.jsxs)(a.A,{gutter:24,children:[(0,r.jsx)(n.A,{span:14,children:(0,r.jsx)(s.A.Item,{label:(0,r.jsx)("span",{style:h,title:x.param_description,children:x.param_description}),name:"".concat(x.param_type,"_sub_type"),labelCol:{flex:"80px"},children:(0,r.jsx)(i.A,{className:"h-10",options:x.sub_types&&x.sub_types.map(e=>({value:e,label:e}))||[],placeholder:"请选择".concat(x.param_description)})})},"".concat(x.param_type,"-col1")),(0,r.jsx)(n.A,{span:10,children:(0,r.jsx)(s.A.Item,{name:"".concat(x.param_type,"_value"),children:(0,r.jsx)(i.A,{options:p,className:"flex-1 h-10",placeholder:"请输入资源",disabled:u.includes(l.getFieldValue("".concat(x.param_type,"_sub_type")))})})},"".concat(x.param_type,"-col2"))]},x.param_type);case"fault_type":return(0,r.jsx)(a.A,{gutter:24,children:(0,r.jsx)(n.A,{span:24,children:(0,r.jsx)(s.A.Item,{label:(0,r.jsx)("span",{style:h,title:x.param_description,children:x.param_description}),name:"".concat(x.param_type,"_value"),labelCol:{flex:"80px"},initialValue:x.param_default_value,children:(0,r.jsx)(i.A,{options:x.param_type_options||[],className:"h-10",placeholder:"请选择故障类型",onBlur:()=>d("".concat(x.param_type,"_value"))})})},"".concat(x.param_type,"-col1"))},x.param_type);default:return null}})})})},93640:(e,l,t)=>{t.d(l,{A:()=>d});var r=t(89638),a=t(47937),n=t(81702),s=t(95069),i=t(94326),o=t(12115),c=t(70061),u=t(49509);let d=e=>{let{queryAgentURL:l="/api/v1/chat/completions",app_code:t}=e,[d,p]=(0,o.useState)({});return{chat:(0,o.useCallback)(async e=>{var o,d,m;let{data:h,onMessage:x,onClose:v,onDone:y,onError:f,ctrl:_}=e;if(_&&p(_),!(null==h?void 0:h.user_input)&&!(null==h?void 0:h.doc_id))return void i.Ay.warning(r.A.t("no_context_tip"));let g={...h,app_code:t},j=null==h||null==(o=h.ext_info)?void 0:o.incremental,b="",w={nodeId:"",text:""},N=new c.yh;try{await (0,s.y)("".concat(null!=(d=u.env.NEXT_PUBLIC_API_BASE_URL)?d:"").concat(l),{method:"POST",headers:{"Content-Type":"application/json",[n.uz]:null!=(m=(0,a.F6)())?m:""},body:JSON.stringify(g),signal:_?_.signal:null,openWhenHidden:!0,async onopen(e){e.ok&&e.headers.get("content-type")===s.o||"application/json"===e.headers.get("content-type")&&e.json().then(e=>{null==x||x(e),null==y||y(),_&&_.abort()})},onclose(){_&&_.abort(),null==v||v()},onerror(e){throw console.log("err",e),Error(e)},onmessage:e=>{let l=e.data;try{if(j){let{answerText:e,midMsgObject:t}=function(e,l,t,r){let a=l||{nodeId:"",text:""},n=t.vis;return a.text=r.update(n),{answerText:e||"",midMsgObject:a}}(b,w,JSON.parse(l),N);b=e,l=t.text}else l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"string"==typeof l?"[DONE]"===l?null==y||y():(null==l?void 0:l.startsWith("[ERROR]"))?null==f||f(null==l?void 0:l.replace("[ERROR]","")):null==x||x(l):(null==x||x(l),null==y||y())}})}catch(e){_&&_.abort(),null==f||f("Sorry, We meet some error, please try agin later.",e)}},[l,t]),ctrl:d}}}}]);