(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1910],{21208:(e,l,a)=>{"use strict";a.d(l,{default:()=>J});var t=a(95155),s=a(91070),n=a(28867),r=a(7132),o=a(66766),i=a(12115);let c=(0,i.memo)(e=>{let{width:l,height:a,model:s}=e,n=(0,i.useMemo)(()=>(0,r.ZI)(s||"huggingface"),[s]);return s?(0,t.jsx)(o.default,{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:l||24,height:a||24,src:n,alt:"llm",priority:!0}):null});var d=a(47937),p=a(81702),m=a(88276),u=a(95069),h=a(78936),_=a(17295),x=a(24517),g=a(54099),f=a(55887),v=a(32570),y=a(97226),j=a(98696),b=a(6124),A=a(94481),N=a(32013),w=a(56939),S=a(29300),C=a.n(S),E=a(39092),F=a(55028),O=a(35695),V=a(91218);a(91214);var k=a(49509);let I=(0,F.default)(()=>a.e(6452).then(a.bind(a,96452)),{loadableGenerated:{webpack:()=>[96452]},ssr:!1}),P=new E.A,L=(0,F.default)(()=>Promise.all([a.e(562),a.e(240),a.e(5600),a.e(2826),a.e(7330),a.e(4935),a.e(4316),a.e(8779),a.e(3930),a.e(3485),a.e(5033),a.e(7985),a.e(797),a.e(2343),a.e(6467),a.e(7744),a.e(2275),a.e(873),a.e(9211),a.e(6680),a.e(4496)]).then(a.bind(a,40102)),{loadableGenerated:{webpack:()=>[40102]},ssr:!1}),T=[{value:"Agent",label:"AGENT"},{value:"Scene",label:"SCENE"},{value:"Normal",label:"NORMAL"},{value:"Evaluate",label:"EVALUATE"}],J=()=>{var e;let l=(0,O.useRouter)(),a=(0,O.useParams)(),r=(null==a?void 0:a.type)||"",{t:o}=(0,V.Bd)(),{modelList:S,model:E,mode:F}=(0,i.useContext)(s.UK),J="dark"===F?_.j:x.n,{message:R}=f.A.useApp(),[M,U]=(0,i.useState)(""),[q,W]=(0,i.useState)([]),[z,B]=(0,i.useState)({}),[G,H]=(0,i.useState)([]),[D,K]=(0,i.useState)(!1),[X]=v.A.useForm(),[Y]=v.A.useForm(),[Z]=v.A.useForm(),[Q,$]=(0,i.useState)(),ee=v.A.useWatch("prompt_type",X),el=(0,i.useMemo)(()=>S.map(e=>({value:e,label:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(c,{model:e}),(0,t.jsx)("span",{className:"ml-2",children:e})]})})),[S]),ea=(0,i.useCallback)(e=>{U(e.text)},[]),{data:et,run:es,loading:en}=(0,g.A)(async e=>await (0,n.C5)(e),{manual:!0}),{run:er}=(0,g.A)(async e=>await (0,n.b1)({prompt_type:ee,target:null!=e?e:"",sub_target:""}),{manual:!0,onSuccess:e=>{if(e){let{data:l}=e.data;U(l.template),W(l.input_variables);try{let e=JSON.parse(l.response_format);B(e||{})}catch(e){B({})}}}}),{run:eo,loading:ei}=(0,g.A)(async e=>"add"===r?await (0,n.Vb)((0,n.Wz)(e)):await (0,n.Vb)((0,n.qj)(e)),{manual:!0,onSuccess:()=>{R.success("".concat("add"===r?o("Add"):o("update")).concat(o("success"))),l.replace("/prompt")}}),ec=async()=>{if(D)return;let e=Y.getFieldsValue();if(!Z.getFieldValue("user_input"))return void R.warning(o("Please_fill_in_the_user_input"));X.validateFields().then(async l=>{let a={sub_chat_scene:"",model:Z.getFieldValue("model"),chat_scene:l.target,prompt_name:l.prompt_name,prompt_type:l.prompt_type,content:M,response_schema:JSON.stringify(z),input_variables:JSON.stringify(q),prompt_language:Z.getFieldValue("prompt_language"),prompt_desc:"",prompt_code:l.prompt_code,debug_model:Z.getFieldValue("model"),input_values:{...e},user_input:Z.getFieldValue("user_input")},t=[{role:"view",context:""}],s=t.length-1;try{var n,r;K(!0),await (0,u.y)("".concat(null!=(n=k.env.NEXT_PUBLIC_API_BASE_URL)?n:"","/prompt/template/debug"),{method:"POST",headers:{"Content-Type":"application/json",[p.uz]:null!=(r=(0,d.F6)())?r:""},body:JSON.stringify(a),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===u.o)return},onclose(){K(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;if(l){try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?K(!1):(null==l?void 0:l.startsWith("[ERROR]"))?(K(!1),t[s].context=null==l?void 0:l.replace("[ERROR]","")):(t[s].context=l,H([...t]))}}})}catch(e){K(!1),t[s].context="Sorry, we meet some error, please try again later",H([...t])}})},{run:ed,loading:ep}=(0,g.A)(async()=>await (0,n.f1)({llm_out:G[0].context,prompt_type:X.getFieldValue("prompt_type"),chat_scene:X.getFieldValue("target")}),{manual:!0,onSuccess:e=>{var l,a;(null==e||null==(l=e.data)?void 0:l.success)?$({msg:"验证通过",status:"success"}):$({msg:null==e||null==(a=e.data)?void 0:a.err_msg,status:"error"})}});(0,i.useEffect)(()=>{E&&Z.setFieldsValue({model:E})},[Z,E]),(0,i.useEffect)(()=>{ee&&es(ee)},[es,ee]);let em=(0,i.useMemo)(()=>{var e,l;return null==et||null==(l=et.data)||null==(e=l.data)?void 0:e.map(e=>({...e,value:e.name,label:e.name}))},[et]);return(0,i.useEffect)(()=>{if("edit"===r){var e;let l=JSON.parse(localStorage.getItem("edit_prompt_data")||"{}");W(JSON.parse(null!=(e=l.input_variables)?e:"[]")),U(null==l?void 0:l.content),X.setFieldsValue({prompt_type:l.prompt_type,prompt_name:l.prompt_name,prompt_code:l.prompt_code,target:l.chat_scene}),Z.setFieldsValue({model:l.model,prompt_language:l.prompt_language})}},[Z,X,r]),(0,t.jsxs)("div",{className:"flex flex-col w-full h-full justify-between dark:bg-gradient-dark }",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between px-6 py-2 h-14 border-b border-[#edeeef]",children:[(0,t.jsxs)(y.A,{className:"flex items-center",children:[(0,t.jsx)(m.A,{className:"text-base cursor-pointer hover:text-[#0c75fc]",onClick:()=>{localStorage.removeItem("edit_prompt_data"),l.replace("/prompt")}}),(0,t.jsxs)("span",{className:"font-medium text-sm",children:["add"===r?o("Add"):o("Edit")," Prompt"]})]}),(0,t.jsx)(y.A,{children:(0,t.jsx)(j.Ay,{type:"primary",onClick:()=>{X.validateFields().then(async e=>{let l={sub_chat_scene:"",model:Z.getFieldValue("model"),chat_scene:e.target,prompt_name:e.prompt_name,prompt_type:e.prompt_type,content:M,response_schema:JSON.stringify(z),input_variables:JSON.stringify(q),prompt_language:Z.getFieldValue("prompt_language"),prompt_desc:"",user_name:"",..."edit"===r&&{prompt_code:e.prompt_code}};await eo(l)})},loading:ei,children:"add"===r?o("save"):o("update")})})]}),(0,t.jsxs)("section",{className:"flex h-full p-4 gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col flex-1 h-full overflow-y-auto pb-8",children:G.length>0?(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex-1 min-h-0 h-full",children:(0,t.jsx)(I,{value:M,onChange:ea,renderHTML:e=>P.render(e),view:{html:!1,md:!0,menu:!0}})}),(0,t.jsx)("div",{className:"flex-1 min-h-0 mt-2",children:(0,t.jsx)(b.A,{title:(0,t.jsxs)(y.A,{children:[(0,t.jsx)("span",{children:"LLM OUT"}),Q&&(0,t.jsx)(A.A,{message:Q.msg,type:Q.status,showIcon:!0})]}),className:"h-full overflow-hidden flex flex-col",styles:{body:{height:"100%",overflowY:"auto"}},children:(0,t.jsx)("div",{children:(0,t.jsx)(L,{children:null==G||null==(e=G[0])?void 0:e.context.replace(/\\n/gm,"\n")})})})})]}):(0,t.jsx)("div",{className:"h-full",children:(0,t.jsx)(I,{value:M,onChange:ea,renderHTML:e=>P.render(e),view:{html:!1,md:!0,menu:!0}})})}),(0,t.jsxs)("div",{className:"flex flex-col w-2/5 pb-8 overflow-y-auto",children:[(0,t.jsx)(b.A,{className:"mb-4",children:(0,t.jsxs)(v.A,{form:X,children:[(0,t.jsxs)("div",{className:"flex w-full gap-1 justify-between",children:[(0,t.jsx)(v.A.Item,{label:"Type",name:"prompt_type",className:"w-2/5",rules:[{required:!0,message:o("select_type")}],children:(0,t.jsx)(N.A,{options:T,placeholder:o("select_type"),allowClear:!0})}),(0,t.jsx)(v.A.Item,{name:"target",className:"w-3/5",rules:[{required:!0,message:o("select_scene")}],children:(0,t.jsx)(N.A,{loading:en,placeholder:o("select_scene"),allowClear:!0,showSearch:!0,onChange:async e=>{await er(e)},children:null==em?void 0:em.map(e=>(0,t.jsx)(N.A.Option,{title:e.desc,children:e.label},e.value))})})]}),"edit"===r&&(0,t.jsx)(v.A.Item,{label:"Code",name:"prompt_code",children:(0,t.jsx)(w.A,{disabled:!0})}),(0,t.jsx)(v.A.Item,{label:"Name",name:"prompt_name",className:"m-0",rules:[{required:!0,message:o("Please_input_prompt_name")}],children:(0,t.jsx)(w.A,{placeholder:o("Please_input_prompt_name")})})]})}),(0,t.jsx)(b.A,{title:o("input_parameter"),className:"mb-4",children:(0,t.jsx)(v.A,{form:Y,children:q.length>0&&q.filter(e=>"out_schema"!==e).map(e=>(0,t.jsx)(v.A.Item,{label:e,name:e,children:(0,t.jsx)(w.A,{placeholder:o("Please_Input")})},e))})}),(0,t.jsxs)(b.A,{title:o("output_structure"),className:"flex flex-col flex-1",children:[(0,t.jsx)(h.Ay,{style:{...J,width:"100%",padding:4},className:C()({"bg-[#fafafa]":"light"===F}),value:z,enableClipboard:!1,displayDataTypes:!1,objectSortKeys:!1}),(0,t.jsx)("div",{className:"flex flex-col mt-4",children:(0,t.jsxs)(v.A,{form:Z,initialValues:{model:E,prompt_language:"en"},children:[(0,t.jsx)(v.A.Item,{label:o("model"),name:"model",children:(0,t.jsx)(N.A,{className:"h-8 rounded-3xl",options:el,allowClear:!0,showSearch:!0})}),(0,t.jsx)(v.A.Item,{label:o("language"),name:"prompt_language",children:(0,t.jsx)(N.A,{options:[{label:o("English"),value:"en"},{label:o("Chinese"),value:"zh"}]})}),(0,t.jsx)(v.A.Item,{label:o("User_input"),name:"user_input",children:(0,t.jsx)(w.A,{placeholder:o("Please_Input")})})]})}),(0,t.jsxs)(y.A,{className:"flex justify-between",children:[(0,t.jsx)(j.Ay,{type:"primary",onClick:ec,loading:D,children:o("LLM_test")}),(0,t.jsx)(j.Ay,{type:"primary",onClick:async()=>{var e;!ep&&(null==(e=G[0])?void 0:e.context)&&await ed()},children:o("Output_verification")})]})]})]})]})]})}},21683:(e,l,a)=>{Promise.resolve().then(a.bind(a,21208))}},e=>{e.O(0,[823,8052,3769,8742,9634,7648,6939,5566,2807,6124,3652,5887,8637,1070,8441,5964,7358],()=>e(e.s=21683)),_N_E=e.O()}]);