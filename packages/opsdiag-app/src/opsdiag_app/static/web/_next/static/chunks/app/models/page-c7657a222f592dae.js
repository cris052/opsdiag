(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8329],{2785:()=>{},13781:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>D});var t=a(95155),s=a(28867),r=a(84182),n=a(91070),i=a(7132),o=a(66766),d=a(12115),c=a(91218);let m="/models/huggingface.svg";var p=a(32013),u=a(32570),h=a(94326),x=a(17980),f=a(31776),_=a(29300),v=a.n(_),j=a(63715),b=a(9130),y=a(15982);let{Option:g}=p.A;function w(e){return(null==e?void 0:e.type)&&(e.type.isSelectOption||e.type.isSelectOptGroup)}let A=d.forwardRef((e,l)=>{var a,t;let s,r,{prefixCls:n,className:i,popupClassName:o,dropdownClassName:c,children:m,dataSource:u,dropdownStyle:h,dropdownRender:f,popupRender:_,onDropdownVisibleChange:A,onOpenChange:N,styles:k,classNames:O}=e,C=(0,j.A)(m),E=(null==(a=null==k?void 0:k.popup)?void 0:a.root)||h,V=(null==(t=null==O?void 0:O.popup)?void 0:t.root)||o||c;1===C.length&&d.isValidElement(C[0])&&!w(C[0])&&([s]=C);let S=s?()=>s:void 0;r=C.length&&w(C[0])?m:u?u.map(e=>{if(d.isValidElement(e))return e;switch(typeof e){case"string":return d.createElement(g,{key:e,value:e},e);case"object":{let{value:l}=e;return d.createElement(g,{key:l,value:l},e.text)}default:return}}):[];let{getPrefixCls:F}=d.useContext(y.QO),P=F("select",n),[q]=(0,b.YK)("SelectLike",null==E?void 0:E.zIndex);return d.createElement(p.A,Object.assign({ref:l,suffixIcon:null},(0,x.A)(e,["dataSource","dropdownClassName","popupClassName"]),{prefixCls:P,classNames:{popup:{root:V},root:null==O?void 0:O.root},styles:{popup:{root:Object.assign(Object.assign({},E),{zIndex:q})},root:null==k?void 0:k.root},className:v()("".concat(P,"-auto-complete"),i),mode:p.A.SECRET_COMBOBOX_MODE_DO_NOT_USE,popupRender:_||f,onOpenChange:N||A,getInputElement:S}),r)}),{Option:N}=p.A,k=(0,f.A)(A,"dropdownAlign",e=>(0,x.A)(e,["visible"]));A.Option=N,A._InternalPanelDoNotUseOrYouWillBeFired=k;var O=a(97540),C=a(98696),E=a(30961),V=a(56939),S=a(76174),F=a(21103);let P=e=>{let{parentName:l,fields:a,form:s}=e,[r,n]=(0,d.useState)(null);return(0,d.useEffect)(()=>{let e=s.getFieldValue(l);(null==e?void 0:e.type)&&!r&&n(e.type)},[s,l]),(0,t.jsxs)("div",{className:"space-y-4 border rounded-md p-4",children:[(0,t.jsx)(u.A.Item,{label:"Type",name:[l,"type"],children:(0,t.jsx)(p.A,{onChange:e=>{n(e);let t=a[e]||[],r={type:e};t.forEach(e=>{r[e.param_name]=e.default_value}),s.setFieldsValue({[l]:r})},placeholder:"Select a type",children:Object.keys(a).map(e=>(0,t.jsx)(p.A.Option,{value:e,children:e},e))})}),r&&a[r]&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("h4",{className:"mb-4 text-base font-medium",children:[r," Configuration"]}),(0,t.jsx)("div",{className:"space-y-4",children:a[r].map(e=>(e=>{let a,s=e.param_type.toLowerCase(),n=[l,e.param_name];return a="str"===s||"string"===s?e.valid_values?(0,t.jsx)(p.A,{children:e.valid_values.map(e=>(0,t.jsx)(p.A.Option,{value:e,children:e},e))}):(0,t.jsx)(V.A,{}):"int"===s||"integer"===s||"number"===s||"float"===s?(0,t.jsx)(S.A,{className:"w-full"}):"bool"===s||"boolean"===s?(0,t.jsx)(F.A,{}):(0,t.jsx)(V.A,{}),(0,t.jsx)(u.A.Item,{label:e.label||e.param_name,name:n,valuePropName:"bool"===s||"boolean"===s?"checked":"value",tooltip:e.description,rules:r&&e.required?[{required:!0,message:"Please input ".concat(e.param_name)}]:[],children:a},e.param_name)})(e))})]})]})},q=function(e){let{params:l,form:a}=e;if((0,d.useEffect)(()=>{if(l){let e={};l.forEach(l=>{l.nested_fields||void 0===a.getFieldValue(l.param_name)&&(e[l.param_name]=l.default_value)}),a.setFieldsValue(e)}},[l,a]),!l||(null==l?void 0:l.length)<1)return null;let s=a.submit;return a.submit=()=>{let e=(e=>{let a={...e};return null==l||l.forEach(e=>{if(e.nested_fields&&a[e.param_name]){let l=a[e.param_name];if(l.type){let t=e.nested_fields[l.type]||[],s={};t.forEach(e=>{void 0!==l[e.param_name]&&(s[e.param_name]=l[e.param_name])}),a[e.param_name]={type:l.type,...s}}}}),a})(a.getFieldsValue());a.setFieldsValue(e),s.call(a)},(0,t.jsx)("div",{className:"space-y-4",children:null==l?void 0:l.map(e=>(0,t.jsx)(u.A.Item,{label:(0,t.jsx)("p",{className:"whitespace-normal overflow-wrap-break-word",children:e.label||e.param_name}),name:e.param_name,initialValue:e.default_value,valuePropName:"bool"===e.param_type.toLowerCase()||"boolean"===e.param_type.toLowerCase()?"checked":"value",tooltip:e.description,rules:e.required?[{required:!0,message:"Please input ".concat(e.label||e.param_name)}]:[],children:function(e){var l,s,r,n,i;if(e.nested_fields)return(0,t.jsx)(P,{parentName:e.param_name,fields:e.nested_fields,form:a});let o=e.param_type.toLowerCase(),d=null==(s=e.ext_metadata)||null==(l=s.tags)?void 0:l.includes("fixed"),c=null==(n=e.ext_metadata)||null==(r=n.tags)?void 0:r.includes("privacy");if("str"===o||"string"===o){if(e.valid_values)return Array.isArray(i=e.valid_values)&&0!==i.length&&"object"==typeof i[0]&&null!==i[0]&&"key"in i[0]&&"label"in i[0]?(0,t.jsx)(p.A,{disabled:d,children:e.valid_values.map(e=>(0,t.jsx)(p.A.Option,{value:e.key,children:e.label},e.key))}):(0,t.jsx)(p.A,{disabled:d,children:e.valid_values.map(e=>(0,t.jsx)(p.A.Option,{value:e,children:e},e))});return c?(0,t.jsx)(V.A.Password,{disabled:d,autoComplete:"new-password",placeholder:"请输入密码"}):(0,t.jsx)(V.A,{disabled:d})}return"int"===o||"integer"===o||"number"===o||"float"===o?(0,t.jsx)(S.A,{className:"w-full",disabled:d}):"bool"===o||"boolean"===o?(0,t.jsx)(F.A,{disabled:d}):(0,t.jsx)(V.A,{disabled:d})}(e)},e.param_name))})},{Option:R}=p.A,T=u.A.Item,B=["llm","text2vec","reranker"],I=function(e){var l;let{onCancel:a,onSuccess:r}=e,{t:n}=(0,c.Bd)(),[x,f]=(0,d.useState)([]),[_,v]=(0,d.useState)(),[j,b]=(0,d.useState)(),[y,g]=(0,d.useState)(null),[w,N]=(0,d.useState)(!1),[k]=u.A.useForm(),[V,S]=(0,d.useState)({}),[F,P]=(0,d.useState)([]);async function I(){let[,e]=await (0,s.Vb)((0,s.Mz)());if(e&&e.length){let l=e.sort((e,l)=>e.enabled&&!l.enabled?-1:!e.enabled&&l.enabled?1:e.model.localeCompare(l.model));f(l),S(l.reduce((e,l)=>{let a=l.provider;return e[a]||(e[a]=[]),e[a].push(l),e},{})),P([])}}async function H(e){if(j&&_){N(!0);try{var l;let a=(e=>{let l={...e};return null==y||y.forEach(e=>{if(e.nested_fields&&l[e.param_name]){let a=l[e.param_name];if(a.type){let t=e.nested_fields[a.type]||[],s={};t.forEach(e=>{void 0!==a[e.param_name]&&(s[e.param_name]=a[e.param_name])}),l[e.param_name]={...s,type:a.type}}}}),l})(e),t=null==(l=V[j])?void 0:l.find(e=>e.model===a.name),i={host:(null==t?void 0:t.host)||"",port:(null==t?void 0:t.port)||0,model:a.name,worker_type:_,params:a},[,,o]=await (0,s.Vb)((0,s.kQ)(i));(null==o?void 0:o.success)&&(h.Ay.success(n("start_model_success")),k.resetFields(),null==r||r())}catch(e){h.Ay.error(n("start_model_failed"))}finally{N(!1)}}}return(0,d.useEffect)(()=>{I()},[]),(0,t.jsxs)(u.A,{form:k,labelCol:{span:8},wrapperCol:{span:16},onFinish:H,children:[(0,t.jsx)(T,{label:"Worker Type",name:"worker_type",rules:[{required:!0,message:n("worker_type_select_tips")}],children:(0,t.jsx)(p.A,{onChange:function(e){v(e),b(void 0),k.resetFields(),k.setFieldValue("worker_type",e);let l=new Set;Object.entries(V).forEach(a=>{let[t,s]=a;s.some(l=>l.worker_type===e)&&l.add(t)}),P(Array.from(l).sort())},placeholder:n("model_select_worker_type"),children:B.map(e=>(0,t.jsx)(R,{value:e,children:e},e))})}),_&&(0,t.jsx)(T,{label:"Provider",name:"provider",rules:[{required:!0,message:n("provider_select_tips")}],children:(0,t.jsx)(p.A,{onChange:function(e){b(e),k.setFieldValue("provider",e);let l=(V[e]||[]).filter(e=>e.worker_type===_);if(l.length>0){let e=l[0];(null==e?void 0:e.params)&&g(Array.isArray(e.params)?e.params:[e.params])}},placeholder:n("model_select_provider"),value:j,children:F.map(e=>(0,t.jsx)(R,{value:e,children:e},e))})}),j&&_&&y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T,{label:n("model_deploy_name"),name:"name",rules:[{required:!0,message:n("model_please_input_name")}],children:(0,t.jsx)(A,{style:{width:"100%"},placeholder:n("model_select_or_input_model"),options:null==(l=V[j])?void 0:l.filter(e=>e.worker_type===_).map(e=>({value:e.model,label:(0,t.jsx)("div",{className:"flex items-center w-full",children:(0,t.jsxs)("div",{className:"flex items-center",children:[function(e,l){var a,s;let{width:r,height:n}={};return e?(0,t.jsx)(o.default,{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:r||24,height:n||24,src:(null==(a=i.zq[e])?void 0:a.icon)||m,alt:"llm"},(null==(s=i.zq[e])?void 0:s.icon)||m):null}(e.model),(0,t.jsx)(O.A,{title:(0,t.jsxs)("div",{className:"max-w-md",children:[(0,t.jsx)("div",{className:"whitespace-pre-wrap markdown-body",children:(0,t.jsx)(E.oz,{children:e.description||e.model})}),(0,t.jsx)("div",{className:"mt-2 text-xs opacity-75",children:e.enabled?"".concat(e.host,":").concat(e.port):n("download_model_tip")})]}),placement:"right",children:(0,t.jsx)("span",{className:"ml-2",children:e.model})})]})})})),filterOption:(e,l)=>-1!==l.value.toUpperCase().indexOf(e.toUpperCase())})}),(0,t.jsx)(q,{params:y.filter(e=>"name"!==e.param_name),form:k})]}),(0,t.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,t.jsx)(C.Ay,{type:"primary",htmlType:"submit",loading:w,children:n("submit")}),(0,t.jsx)(C.Ay,{onClick:a,children:n("cancel")})]})]})};var H=a(44261),L=a(96194),M=a(37974),U=a(82940),Y=a.n(U),z=a(35695);function D(){let{t:e}=(0,c.Bd)(),{setCurrentDialogInfo:l,setModel:a}=(0,d.useContext)(n.UK),[o,m]=(0,d.useState)([]),[p,u]=(0,d.useState)(!1),[x,f]=(0,d.useState)(!1),_=(0,z.useRouter)();async function v(){let[,e]=await (0,s.Vb)((0,s.O6)());m(null!=e?e:[])}async function j(l){if(x)return;let a=e("confirm_start_model")+l.model_name;y(e("start_model"),a,async()=>{f(!0);let[,,a]=await (0,s.Vb)((0,s.Mn)({host:l.host,port:l.port,model:l.model_name,worker_type:l.worker_type,delete_after:!1,params:{}}));f(!1),(null==a?void 0:a.success)&&(h.Ay.success(e("start_model_success")),await v())})}async function b(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(x)return;let t=a?"stop_and_delete":"stop",r=e("confirm_".concat(t,"_model"))+l.model_name;y(e("".concat(t,"_model")),r,async()=>{f(!0);let[,,r]=await (0,s.Vb)((0,s.kE)({host:l.host,port:l.port,model:l.model_name,worker_type:l.worker_type,delete_after:a,params:{}}));f(!1),(null==r?void 0:r.success)===!0&&(h.Ay.success(e("".concat(t,"_model_success"))),await v())})}let y=(e,l,a)=>{L.A.confirm({title:e,content:l,onOk:async()=>{await a()},okButtonProps:{className:"bg-button-gradient"}})},g=async e=>{let[l,t]=await (0,s.Vb)((0,s.j_)({app_code:"chat_normal",model:e.model_name}));(null==t?void 0:t.conv_uid)&&(a(e.model_name),_.push("/chat?app_code=chat_normal&conv_uid=".concat(null==t?void 0:t.conv_uid,"&model=").concat(e.model_name)))};return(0,d.useEffect)(()=>{v()},[]),(0,t.jsxs)("div",{className:"h-screen w-full p-4 md:p-6 ",children:[(0,t.jsx)("div",{className:"flex justify-end items-center mb-6",children:(0,t.jsx)("div",{className:"flex items-center gap-4",children:(0,t.jsx)(C.Ay,{className:"border-none text-white bg-button-gradient",icon:(0,t.jsx)(H.A,{}),onClick:()=>{u(!0)},children:e("create_model")})})}),(0,t.jsx)("div",{className:"mx-[-8px] overflow-y-auto h-full pb-12",children:(0,t.jsx)("div",{className:"flex flex-wrap",children:o.map(l=>{let a;return(0,t.jsx)(r.Ay,{logo:(a=l.model_name,(0,i.ZI)(a)),description:(0,t.jsxs)("div",{className:"flex flex-col gap-1 relative text-xs bottom-4",children:[(0,t.jsxs)("div",{className:"flex overflow-hidden",children:[(0,t.jsx)("p",{className:"w-28 text-gray-500 mr-2",children:"Host:"}),(0,t.jsx)("p",{className:"flex-1 text-ellipsis",children:l.host})]}),(0,t.jsxs)("div",{className:"flex overflow-hidden",children:[(0,t.jsx)("p",{className:"w-28 text-gray-500 mr-2",children:"Manage Host:"}),(0,t.jsxs)("p",{className:"flex-1 text-ellipsis",children:[l.manager_host,":",l.manager_port]})]}),(0,t.jsxs)("div",{className:"flex overflow-hidden",children:[(0,t.jsx)("p",{className:"w-28 text-gray-500 mr-2",children:"Last Heart Beat:"}),(0,t.jsx)("p",{className:"flex-1 text-ellipsis",children:Y()(l.last_heartbeat).format("YYYY-MM-DD HH:mm:ss")})]})]}),name:l.model_name,RightTop:(0,t.jsx)(r._f,{menu:{items:[{key:"stop_model",label:(0,t.jsx)("span",{className:"text-red-400",onClick:()=>b(l),children:e("stop_model")})},{key:"start_model",label:(0,t.jsx)("span",{className:"text-green-400",onClick:()=>j(l),children:e("start_model")})},{key:"stop_and_delete_model",label:(0,t.jsx)("span",{className:"text-red-400",onClick:()=>b(l,!0),children:e("stop_and_delete_model")})}]}}),rightTopHover:!1,Tags:(0,t.jsxs)("div",{children:[(0,t.jsx)(M.A,{color:l.healthy?"green":"red",children:l.healthy?"Healthy":"Unhealthy"}),(0,t.jsx)(M.A,{children:l.worker_type})]}),RightBottom:(0,t.jsx)(r.VV,{text:e("start_chat"),onClick:()=>{g(l)}})},l.model_name)})})}),(0,t.jsx)(L.A,{width:800,open:p,title:e("create_model"),onCancel:()=>{u(!1)},footer:null,children:(0,t.jsx)(I,{onCancel:()=>{u(!1)},onSuccess:()=>{u(!1),v()}})})]})}},44261:(e,l,a)=>{"use strict";a.d(l,{A:()=>i});var t=a(12115),s=a(3514),r=a(75659);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e}).apply(this,arguments)}let i=t.forwardRef((e,l)=>t.createElement(r.A,n({},e,{ref:l,icon:s.A})))},53025:(e,l,a)=>{Promise.resolve().then(a.bind(a,13781))},81106:(e,l,a)=>{"use strict";a.d(l,{A:()=>i});var t=a(12115),s=a(89593),r=a(75659);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e}).apply(this,arguments)}let i=t.forwardRef((e,l)=>t.createElement(r.A,n({},e,{ref:l,icon:s.A})))},84182:(e,l,a)=>{"use strict";a.d(l,{Ay:()=>x,VV:()=>u,_f:()=>h});var t=a(95155),s=a(81106),r=a(97540),n=a(94600),i=a(90797),o=a(82343),d=a(29300),c=a.n(d),m=a(17985),p=a(66766);a(12115),a(2785);let u=e=>{let{onClick:l,Icon:a="/pictures/card_chat.png",text:s=(0,m.t)("start_chat")}=e;return"string"==typeof a&&(a=(0,t.jsx)(p.default,{src:a,alt:a,width:17,height:15})),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),l&&l()},children:[a,(0,t.jsx)("span",{children:s})]})},h=e=>{let{menu:l}=e;return(0,t.jsx)(o.A,{menu:l,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,t.jsx)(s.A,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})},x=e=>{let{RightTop:l,Tags:a,LeftBottom:s,RightBottom:o,onClick:d,rightTopHover:m=!0,logo:p,name:u,description:h,className:x,scene:f,code:_}=e;return"string"==typeof h&&(h=(0,t.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:h})),(0,t.jsx)("div",{className:c()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",x),children:(0,t.jsxs)("div",{onClick:d,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white/70  border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95]/60",children:[(0,t.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,t.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-2",children:(0,t.jsx)("img",{src:p,alt:u,className:"w-9 min-w-9 rounded-full max-w-none"})}),(0,t.jsx)("div",{className:"flex-1",children:u.length>6?(0,t.jsx)(r.A,{title:u,placement:"topLeft",children:(0,t.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:u})}):(0,t.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:u})})]}),(0,t.jsx)("span",{className:c()("shrink-0",{hidden:m,"group-hover:block":m}),onClick:e=>{e.stopPropagation()},children:l})]}),h,(0,t.jsx)("div",{className:"relative bottom-2",children:a}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{children:s}),(0,t.jsx)("div",{children:o})]}),_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{className:"my-3"}),(0,t.jsx)(i.A.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:_})]})]})})}}},e=>{e.O(0,[1448,586,8052,3769,8742,9634,7985,797,7648,6939,2343,5566,2807,873,6174,1070,8441,5964,7358],()=>e(e.s=53025)),_N_E=e.O()}]);